{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { isContinuousFieldOrDatumDef, isFieldOrDatumDef, title } from '../channeldef';\nimport { extractTransformsFromEncoding, normalizeEncoding } from '../encoding';\nimport * as log from '../log';\nimport { isMarkDef } from '../mark';\nimport { replaceAll, titleCase } from '../util';\nimport { CompositeMarkNormalizer } from './base';\nimport { compositeMarkContinuousAxis, compositeMarkOrient, getCompositeMarkTooltip, makeCompositeAggregatePartFactory } from './common';\nexport const ERRORBAR = 'errorbar';\nexport const ERRORBAR_PARTS = ['ticks', 'rule'];\nexport const errorBarNormalizer = new CompositeMarkNormalizer(ERRORBAR, normalizeErrorBar);\nexport function normalizeErrorBar(spec, {\n  config\n}) {\n  // Need to initEncoding first so we can infer type\n  spec = {\n    ...spec,\n    encoding: normalizeEncoding(spec.encoding, config)\n  };\n  const {\n    transform,\n    continuousAxisChannelDef,\n    continuousAxis,\n    encodingWithoutContinuousAxis,\n    ticksOrient,\n    markDef,\n    outerSpec,\n    tooltipEncoding\n  } = errorBarParams(spec, ERRORBAR, config);\n  delete encodingWithoutContinuousAxis['size'];\n  const makeErrorBarPart = makeCompositeAggregatePartFactory(markDef, continuousAxis, continuousAxisChannelDef, encodingWithoutContinuousAxis, config.errorbar);\n  const thickness = markDef.thickness;\n  const size = markDef.size;\n  const tick = {\n    type: 'tick',\n    orient: ticksOrient,\n    aria: false,\n    ...(thickness !== undefined ? {\n      thickness\n    } : {}),\n    ...(size !== undefined ? {\n      size\n    } : {})\n  };\n  const layer = [...makeErrorBarPart({\n    partName: 'ticks',\n    mark: tick,\n    positionPrefix: 'lower',\n    extraEncoding: tooltipEncoding\n  }), ...makeErrorBarPart({\n    partName: 'ticks',\n    mark: tick,\n    positionPrefix: 'upper',\n    extraEncoding: tooltipEncoding\n  }), ...makeErrorBarPart({\n    partName: 'rule',\n    mark: {\n      type: 'rule',\n      ariaRoleDescription: 'errorbar',\n      ...(thickness !== undefined ? {\n        size: thickness\n      } : {})\n    },\n    positionPrefix: 'lower',\n    endPositionPrefix: 'upper',\n    extraEncoding: tooltipEncoding\n  })];\n  return {\n    ...outerSpec,\n    transform,\n    ...(layer.length > 1 ? {\n      layer\n    } : {\n      ...layer[0]\n    })\n  };\n}\nfunction errorBarOrientAndInputType(spec, compositeMark) {\n  const {\n    encoding\n  } = spec;\n  if (errorBarIsInputTypeRaw(encoding)) {\n    return {\n      orient: compositeMarkOrient(spec, compositeMark),\n      inputType: 'raw'\n    };\n  }\n  const isTypeAggregatedUpperLower = errorBarIsInputTypeAggregatedUpperLower(encoding);\n  const isTypeAggregatedError = errorBarIsInputTypeAggregatedError(encoding);\n  const x = encoding.x;\n  const y = encoding.y;\n  if (isTypeAggregatedUpperLower) {\n    // type is aggregated-upper-lower\n    if (isTypeAggregatedError) {\n      throw new Error(`${compositeMark} cannot be both type aggregated-upper-lower and aggregated-error`);\n    }\n    const x2 = encoding.x2;\n    const y2 = encoding.y2;\n    if (isFieldOrDatumDef(x2) && isFieldOrDatumDef(y2)) {\n      // having both x, x2 and y, y2\n      throw new Error(`${compositeMark} cannot have both x2 and y2`);\n    } else if (isFieldOrDatumDef(x2)) {\n      if (isContinuousFieldOrDatumDef(x)) {\n        // having x, x2 quantitative and field y, y2 are not specified\n        return {\n          orient: 'horizontal',\n          inputType: 'aggregated-upper-lower'\n        };\n      } else {\n        // having x, x2 that are not both quantitative\n        throw new Error(`Both x and x2 have to be quantitative in ${compositeMark}`);\n      }\n    } else if (isFieldOrDatumDef(y2)) {\n      // y2 is a FieldDef\n      if (isContinuousFieldOrDatumDef(y)) {\n        // having y, y2 quantitative and field x, x2 are not specified\n        return {\n          orient: 'vertical',\n          inputType: 'aggregated-upper-lower'\n        };\n      } else {\n        // having y, y2 that are not both quantitative\n        throw new Error(`Both y and y2 have to be quantitative in ${compositeMark}`);\n      }\n    }\n    throw new Error('No ranged axis');\n  } else {\n    // type is aggregated-error\n    const xError = encoding.xError;\n    const xError2 = encoding.xError2;\n    const yError = encoding.yError;\n    const yError2 = encoding.yError2;\n    if (isFieldOrDatumDef(xError2) && !isFieldOrDatumDef(xError)) {\n      // having xError2 without xError\n      throw new Error(`${compositeMark} cannot have xError2 without xError`);\n    }\n    if (isFieldOrDatumDef(yError2) && !isFieldOrDatumDef(yError)) {\n      // having yError2 without yError\n      throw new Error(`${compositeMark} cannot have yError2 without yError`);\n    }\n    if (isFieldOrDatumDef(xError) && isFieldOrDatumDef(yError)) {\n      // having both xError and yError\n      throw new Error(`${compositeMark} cannot have both xError and yError with both are quantiative`);\n    } else if (isFieldOrDatumDef(xError)) {\n      if (isContinuousFieldOrDatumDef(x)) {\n        // having x and xError that are all quantitative\n        return {\n          orient: 'horizontal',\n          inputType: 'aggregated-error'\n        };\n      } else {\n        // having x, xError, and xError2 that are not all quantitative\n        throw new Error('All x, xError, and xError2 (if exist) have to be quantitative');\n      }\n    } else if (isFieldOrDatumDef(yError)) {\n      if (isContinuousFieldOrDatumDef(y)) {\n        // having y and yError that are all quantitative\n        return {\n          orient: 'vertical',\n          inputType: 'aggregated-error'\n        };\n      } else {\n        // having y, yError, and yError2 that are not all quantitative\n        throw new Error('All y, yError, and yError2 (if exist) have to be quantitative');\n      }\n    }\n    throw new Error('No ranged axis');\n  }\n}\nfunction errorBarIsInputTypeRaw(encoding) {\n  return (isFieldOrDatumDef(encoding.x) || isFieldOrDatumDef(encoding.y)) && !isFieldOrDatumDef(encoding.x2) && !isFieldOrDatumDef(encoding.y2) && !isFieldOrDatumDef(encoding.xError) && !isFieldOrDatumDef(encoding.xError2) && !isFieldOrDatumDef(encoding.yError) && !isFieldOrDatumDef(encoding.yError2);\n}\nfunction errorBarIsInputTypeAggregatedUpperLower(encoding) {\n  return isFieldOrDatumDef(encoding.x2) || isFieldOrDatumDef(encoding.y2);\n}\nfunction errorBarIsInputTypeAggregatedError(encoding) {\n  return isFieldOrDatumDef(encoding.xError) || isFieldOrDatumDef(encoding.xError2) || isFieldOrDatumDef(encoding.yError) || isFieldOrDatumDef(encoding.yError2);\n}\nexport function errorBarParams(spec, compositeMark, config) {\n  // TODO: use selection\n  const {\n    mark,\n    encoding,\n    params,\n    projection: _p,\n    ...outerSpec\n  } = spec;\n  const markDef = isMarkDef(mark) ? mark : {\n    type: mark\n  };\n  // TODO(https://github.com/vega/vega-lite/issues/3702): add selection support\n  if (params) {\n    log.warn(log.message.selectionNotSupported(compositeMark));\n  }\n  const {\n    orient,\n    inputType\n  } = errorBarOrientAndInputType(spec, compositeMark);\n  const {\n    continuousAxisChannelDef,\n    continuousAxisChannelDef2,\n    continuousAxisChannelDefError,\n    continuousAxisChannelDefError2,\n    continuousAxis\n  } = compositeMarkContinuousAxis(spec, orient, compositeMark);\n  const {\n    errorBarSpecificAggregate,\n    postAggregateCalculates,\n    tooltipSummary,\n    tooltipTitleWithFieldName\n  } = errorBarAggregationAndCalculation(markDef, continuousAxisChannelDef, continuousAxisChannelDef2, continuousAxisChannelDefError, continuousAxisChannelDefError2, inputType, compositeMark, config);\n  const {\n    [continuousAxis]: oldContinuousAxisChannelDef,\n    [continuousAxis === 'x' ? 'x2' : 'y2']: oldContinuousAxisChannelDef2,\n    [continuousAxis === 'x' ? 'xError' : 'yError']: oldContinuousAxisChannelDefError,\n    [continuousAxis === 'x' ? 'xError2' : 'yError2']: oldContinuousAxisChannelDefError2,\n    ...oldEncodingWithoutContinuousAxis\n  } = encoding;\n  const {\n    bins,\n    timeUnits,\n    aggregate: oldAggregate,\n    groupby: oldGroupBy,\n    encoding: encodingWithoutContinuousAxis\n  } = extractTransformsFromEncoding(oldEncodingWithoutContinuousAxis, config);\n  const aggregate = [...oldAggregate, ...errorBarSpecificAggregate];\n  const groupby = inputType !== 'raw' ? [] : oldGroupBy;\n  const tooltipEncoding = getCompositeMarkTooltip(tooltipSummary, continuousAxisChannelDef, encodingWithoutContinuousAxis, tooltipTitleWithFieldName);\n  return {\n    transform: [...(outerSpec.transform ?? []), ...bins, ...timeUnits, ...(aggregate.length === 0 ? [] : [{\n      aggregate,\n      groupby\n    }]), ...postAggregateCalculates],\n    groupby,\n    continuousAxisChannelDef,\n    continuousAxis,\n    encodingWithoutContinuousAxis,\n    ticksOrient: orient === 'vertical' ? 'horizontal' : 'vertical',\n    markDef,\n    outerSpec,\n    tooltipEncoding\n  };\n}\nfunction errorBarAggregationAndCalculation(markDef, continuousAxisChannelDef, continuousAxisChannelDef2, continuousAxisChannelDefError, continuousAxisChannelDefError2, inputType, compositeMark, config) {\n  let errorBarSpecificAggregate = [];\n  let postAggregateCalculates = [];\n  const continuousFieldName = continuousAxisChannelDef.field;\n  let tooltipSummary;\n  let tooltipTitleWithFieldName = false;\n  if (inputType === 'raw') {\n    const center = markDef.center ? markDef.center : markDef.extent ? markDef.extent === 'iqr' ? 'median' : 'mean' : config.errorbar.center;\n    const extent = markDef.extent ? markDef.extent : center === 'mean' ? 'stderr' : 'iqr';\n    if (center === 'median' !== (extent === 'iqr')) {\n      log.warn(log.message.errorBarCenterIsUsedWithWrongExtent(center, extent, compositeMark));\n    }\n    if (extent === 'stderr' || extent === 'stdev') {\n      errorBarSpecificAggregate = [{\n        op: extent,\n        field: continuousFieldName,\n        as: `extent_${continuousFieldName}`\n      }, {\n        op: center,\n        field: continuousFieldName,\n        as: `center_${continuousFieldName}`\n      }];\n      postAggregateCalculates = [{\n        calculate: `datum[\"center_${continuousFieldName}\"] + datum[\"extent_${continuousFieldName}\"]`,\n        as: `upper_${continuousFieldName}`\n      }, {\n        calculate: `datum[\"center_${continuousFieldName}\"] - datum[\"extent_${continuousFieldName}\"]`,\n        as: `lower_${continuousFieldName}`\n      }];\n      tooltipSummary = [{\n        fieldPrefix: 'center_',\n        titlePrefix: titleCase(center)\n      }, {\n        fieldPrefix: 'upper_',\n        titlePrefix: getTitlePrefix(center, extent, '+')\n      }, {\n        fieldPrefix: 'lower_',\n        titlePrefix: getTitlePrefix(center, extent, '-')\n      }];\n      tooltipTitleWithFieldName = true;\n    } else {\n      let centerOp;\n      let lowerExtentOp;\n      let upperExtentOp;\n      if (extent === 'ci') {\n        centerOp = 'mean';\n        lowerExtentOp = 'ci0';\n        upperExtentOp = 'ci1';\n      } else {\n        centerOp = 'median';\n        lowerExtentOp = 'q1';\n        upperExtentOp = 'q3';\n      }\n      errorBarSpecificAggregate = [{\n        op: lowerExtentOp,\n        field: continuousFieldName,\n        as: `lower_${continuousFieldName}`\n      }, {\n        op: upperExtentOp,\n        field: continuousFieldName,\n        as: `upper_${continuousFieldName}`\n      }, {\n        op: centerOp,\n        field: continuousFieldName,\n        as: `center_${continuousFieldName}`\n      }];\n      tooltipSummary = [{\n        fieldPrefix: 'upper_',\n        titlePrefix: title({\n          field: continuousFieldName,\n          aggregate: upperExtentOp,\n          type: 'quantitative'\n        }, config, {\n          allowDisabling: false\n        })\n      }, {\n        fieldPrefix: 'lower_',\n        titlePrefix: title({\n          field: continuousFieldName,\n          aggregate: lowerExtentOp,\n          type: 'quantitative'\n        }, config, {\n          allowDisabling: false\n        })\n      }, {\n        fieldPrefix: 'center_',\n        titlePrefix: title({\n          field: continuousFieldName,\n          aggregate: centerOp,\n          type: 'quantitative'\n        }, config, {\n          allowDisabling: false\n        })\n      }];\n    }\n  } else {\n    if (markDef.center || markDef.extent) {\n      log.warn(log.message.errorBarCenterAndExtentAreNotNeeded(markDef.center, markDef.extent));\n    }\n    if (inputType === 'aggregated-upper-lower') {\n      tooltipSummary = [];\n      postAggregateCalculates = [{\n        calculate: `datum[\"${continuousAxisChannelDef2.field}\"]`,\n        as: `upper_${continuousFieldName}`\n      }, {\n        calculate: `datum[\"${continuousFieldName}\"]`,\n        as: `lower_${continuousFieldName}`\n      }];\n    } else if (inputType === 'aggregated-error') {\n      tooltipSummary = [{\n        fieldPrefix: '',\n        titlePrefix: continuousFieldName\n      }];\n      postAggregateCalculates = [{\n        calculate: `datum[\"${continuousFieldName}\"] + datum[\"${continuousAxisChannelDefError.field}\"]`,\n        as: `upper_${continuousFieldName}`\n      }];\n      if (continuousAxisChannelDefError2) {\n        postAggregateCalculates.push({\n          calculate: `datum[\"${continuousFieldName}\"] + datum[\"${continuousAxisChannelDefError2.field}\"]`,\n          as: `lower_${continuousFieldName}`\n        });\n      } else {\n        postAggregateCalculates.push({\n          calculate: `datum[\"${continuousFieldName}\"] - datum[\"${continuousAxisChannelDefError.field}\"]`,\n          as: `lower_${continuousFieldName}`\n        });\n      }\n    }\n    for (const postAggregateCalculate of postAggregateCalculates) {\n      tooltipSummary.push({\n        fieldPrefix: postAggregateCalculate.as.substring(0, 6),\n        titlePrefix: replaceAll(replaceAll(postAggregateCalculate.calculate, 'datum[\"', ''), '\"]', '')\n      });\n    }\n  }\n  return {\n    postAggregateCalculates,\n    errorBarSpecificAggregate,\n    tooltipSummary,\n    tooltipTitleWithFieldName\n  };\n}\nfunction getTitlePrefix(center, extent, operation) {\n  return `${titleCase(center)} ${operation} ${extent}`;\n}","map":{"version":3,"names":["isContinuousFieldOrDatumDef","isFieldOrDatumDef","title","extractTransformsFromEncoding","normalizeEncoding","log","isMarkDef","replaceAll","titleCase","CompositeMarkNormalizer","compositeMarkContinuousAxis","compositeMarkOrient","getCompositeMarkTooltip","makeCompositeAggregatePartFactory","ERRORBAR","ERRORBAR_PARTS","errorBarNormalizer","normalizeErrorBar","spec","config","encoding","transform","continuousAxisChannelDef","continuousAxis","encodingWithoutContinuousAxis","ticksOrient","markDef","outerSpec","tooltipEncoding","errorBarParams","makeErrorBarPart","errorbar","thickness","size","tick","type","orient","aria","undefined","layer","partName","mark","positionPrefix","extraEncoding","ariaRoleDescription","endPositionPrefix","length","errorBarOrientAndInputType","compositeMark","errorBarIsInputTypeRaw","inputType","isTypeAggregatedUpperLower","errorBarIsInputTypeAggregatedUpperLower","isTypeAggregatedError","errorBarIsInputTypeAggregatedError","x","y","Error","x2","y2","xError","xError2","yError","yError2","params","projection","_p","warn","message","selectionNotSupported","continuousAxisChannelDef2","continuousAxisChannelDefError","continuousAxisChannelDefError2","errorBarSpecificAggregate","postAggregateCalculates","tooltipSummary","tooltipTitleWithFieldName","errorBarAggregationAndCalculation","oldContinuousAxisChannelDef","oldContinuousAxisChannelDef2","oldContinuousAxisChannelDefError","oldContinuousAxisChannelDefError2","oldEncodingWithoutContinuousAxis","bins","timeUnits","aggregate","oldAggregate","groupby","oldGroupBy","continuousFieldName","field","center","extent","errorBarCenterIsUsedWithWrongExtent","op","as","calculate","fieldPrefix","titlePrefix","getTitlePrefix","centerOp","lowerExtentOp","upperExtentOp","allowDisabling","errorBarCenterAndExtentAreNotNeeded","push","postAggregateCalculate","substring","operation"],"sources":["../../../src/compositemark/errorbar.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}