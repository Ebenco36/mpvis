{"ast":null,"code":"import { isNumber, isObject } from 'vega-util';\nimport { getMarkPropOrConfig } from '../compile/common';\nimport { extractTransformsFromEncoding, normalizeEncoding } from '../encoding';\nimport * as log from '../log';\nimport { isMarkDef } from '../mark';\nimport { isEmpty, omit } from '../util';\nimport { CompositeMarkNormalizer } from './base';\nimport { compositeMarkContinuousAxis, compositeMarkOrient, filterTooltipWithAggregatedField, getCompositeMarkTooltip, getTitle, makeCompositeAggregatePartFactory, partLayerMixins } from './common';\nexport const BOXPLOT = 'boxplot';\nexport const BOXPLOT_PARTS = ['box', 'median', 'outliers', 'rule', 'ticks'];\nexport const boxPlotNormalizer = new CompositeMarkNormalizer(BOXPLOT, normalizeBoxPlot);\nexport function getBoxPlotType(extent) {\n  if (isNumber(extent)) {\n    return 'tukey';\n  }\n  // Ham: If we ever want to, we could add another extent syntax `{kIQR: number}` for the original [Q1-k*IQR, Q3+k*IQR] whisker and call this boxPlotType = `kIQR`. However, I'm not exposing this for now.\n  return extent;\n}\nexport function normalizeBoxPlot(spec, {\n  config\n}) {\n  // Need to initEncoding first so we can infer type\n  spec = {\n    ...spec,\n    encoding: normalizeEncoding(spec.encoding, config)\n  };\n  const {\n    mark,\n    encoding: _encoding,\n    params,\n    projection: _p,\n    ...outerSpec\n  } = spec;\n  const markDef = isMarkDef(mark) ? mark : {\n    type: mark\n  };\n  // TODO(https://github.com/vega/vega-lite/issues/3702): add selection support\n  if (params) {\n    log.warn(log.message.selectionNotSupported('boxplot'));\n  }\n  const extent = markDef.extent ?? config.boxplot.extent;\n  const sizeValue = getMarkPropOrConfig('size', markDef,\n  // TODO: https://github.com/vega/vega-lite/issues/6245\n  config);\n  const invalid = markDef.invalid;\n  const boxPlotType = getBoxPlotType(extent);\n  const {\n    bins,\n    timeUnits,\n    transform,\n    continuousAxisChannelDef,\n    continuousAxis,\n    groupby,\n    aggregate,\n    encodingWithoutContinuousAxis,\n    ticksOrient,\n    boxOrient,\n    customTooltipWithoutAggregatedField\n  } = boxParams(spec, extent, config);\n  const {\n    color,\n    size,\n    ...encodingWithoutSizeColorAndContinuousAxis\n  } = encodingWithoutContinuousAxis;\n  const makeBoxPlotPart = sharedEncoding => {\n    return makeCompositeAggregatePartFactory(markDef, continuousAxis, continuousAxisChannelDef, sharedEncoding, config.boxplot);\n  };\n  const makeBoxPlotExtent = makeBoxPlotPart(encodingWithoutSizeColorAndContinuousAxis);\n  const makeBoxPlotBox = makeBoxPlotPart(encodingWithoutContinuousAxis);\n  const makeBoxPlotMidTick = makeBoxPlotPart({\n    ...encodingWithoutSizeColorAndContinuousAxis,\n    ...(size ? {\n      size\n    } : {})\n  });\n  const fiveSummaryTooltipEncoding = getCompositeMarkTooltip([{\n    fieldPrefix: boxPlotType === 'min-max' ? 'upper_whisker_' : 'max_',\n    titlePrefix: 'Max'\n  }, {\n    fieldPrefix: 'upper_box_',\n    titlePrefix: 'Q3'\n  }, {\n    fieldPrefix: 'mid_box_',\n    titlePrefix: 'Median'\n  }, {\n    fieldPrefix: 'lower_box_',\n    titlePrefix: 'Q1'\n  }, {\n    fieldPrefix: boxPlotType === 'min-max' ? 'lower_whisker_' : 'min_',\n    titlePrefix: 'Min'\n  }], continuousAxisChannelDef, encodingWithoutContinuousAxis);\n  // ## Whisker Layers\n  const endTick = {\n    type: 'tick',\n    color: 'black',\n    opacity: 1,\n    orient: ticksOrient,\n    invalid,\n    aria: false\n  };\n  const whiskerTooltipEncoding = boxPlotType === 'min-max' ? fiveSummaryTooltipEncoding // for min-max, show five-summary tooltip for whisker\n  :\n  // for tukey / k-IQR, just show upper/lower-whisker\n  getCompositeMarkTooltip([{\n    fieldPrefix: 'upper_whisker_',\n    titlePrefix: 'Upper Whisker'\n  }, {\n    fieldPrefix: 'lower_whisker_',\n    titlePrefix: 'Lower Whisker'\n  }], continuousAxisChannelDef, encodingWithoutContinuousAxis);\n  const whiskerLayers = [...makeBoxPlotExtent({\n    partName: 'rule',\n    mark: {\n      type: 'rule',\n      invalid,\n      aria: false\n    },\n    positionPrefix: 'lower_whisker',\n    endPositionPrefix: 'lower_box',\n    extraEncoding: whiskerTooltipEncoding\n  }), ...makeBoxPlotExtent({\n    partName: 'rule',\n    mark: {\n      type: 'rule',\n      invalid,\n      aria: false\n    },\n    positionPrefix: 'upper_box',\n    endPositionPrefix: 'upper_whisker',\n    extraEncoding: whiskerTooltipEncoding\n  }), ...makeBoxPlotExtent({\n    partName: 'ticks',\n    mark: endTick,\n    positionPrefix: 'lower_whisker',\n    extraEncoding: whiskerTooltipEncoding\n  }), ...makeBoxPlotExtent({\n    partName: 'ticks',\n    mark: endTick,\n    positionPrefix: 'upper_whisker',\n    extraEncoding: whiskerTooltipEncoding\n  })];\n  // ## Box Layers\n  // TODO: support hiding certain mark parts\n  const boxLayers = [...(boxPlotType !== 'tukey' ? whiskerLayers : []), ...makeBoxPlotBox({\n    partName: 'box',\n    mark: {\n      type: 'bar',\n      ...(sizeValue ? {\n        size: sizeValue\n      } : {}),\n      orient: boxOrient,\n      invalid,\n      ariaRoleDescription: 'box'\n    },\n    positionPrefix: 'lower_box',\n    endPositionPrefix: 'upper_box',\n    extraEncoding: fiveSummaryTooltipEncoding\n  }), ...makeBoxPlotMidTick({\n    partName: 'median',\n    mark: {\n      type: 'tick',\n      invalid,\n      ...(isObject(config.boxplot.median) && config.boxplot.median.color ? {\n        color: config.boxplot.median.color\n      } : {}),\n      ...(sizeValue ? {\n        size: sizeValue\n      } : {}),\n      orient: ticksOrient,\n      aria: false\n    },\n    positionPrefix: 'mid_box',\n    extraEncoding: fiveSummaryTooltipEncoding\n  })];\n  if (boxPlotType === 'min-max') {\n    return {\n      ...outerSpec,\n      transform: (outerSpec.transform ?? []).concat(transform),\n      layer: boxLayers\n    };\n  }\n  // Tukey Box Plot\n  const lowerBoxExpr = `datum[\"lower_box_${continuousAxisChannelDef.field}\"]`;\n  const upperBoxExpr = `datum[\"upper_box_${continuousAxisChannelDef.field}\"]`;\n  const iqrExpr = `(${upperBoxExpr} - ${lowerBoxExpr})`;\n  const lowerWhiskerExpr = `${lowerBoxExpr} - ${extent} * ${iqrExpr}`;\n  const upperWhiskerExpr = `${upperBoxExpr} + ${extent} * ${iqrExpr}`;\n  const fieldExpr = `datum[\"${continuousAxisChannelDef.field}\"]`;\n  const joinaggregateTransform = {\n    joinaggregate: boxParamsQuartiles(continuousAxisChannelDef.field),\n    groupby\n  };\n  const filteredWhiskerSpec = {\n    transform: [{\n      filter: `(${lowerWhiskerExpr} <= ${fieldExpr}) && (${fieldExpr} <= ${upperWhiskerExpr})`\n    }, {\n      aggregate: [{\n        op: 'min',\n        field: continuousAxisChannelDef.field,\n        as: `lower_whisker_${continuousAxisChannelDef.field}`\n      }, {\n        op: 'max',\n        field: continuousAxisChannelDef.field,\n        as: `upper_whisker_${continuousAxisChannelDef.field}`\n      },\n      // preserve lower_box / upper_box\n      {\n        op: 'min',\n        field: `lower_box_${continuousAxisChannelDef.field}`,\n        as: `lower_box_${continuousAxisChannelDef.field}`\n      }, {\n        op: 'max',\n        field: `upper_box_${continuousAxisChannelDef.field}`,\n        as: `upper_box_${continuousAxisChannelDef.field}`\n      }, ...aggregate],\n      groupby\n    }],\n    layer: whiskerLayers\n  };\n  const {\n    tooltip,\n    ...encodingWithoutSizeColorContinuousAxisAndTooltip\n  } = encodingWithoutSizeColorAndContinuousAxis;\n  const {\n    scale,\n    axis\n  } = continuousAxisChannelDef;\n  const title = getTitle(continuousAxisChannelDef);\n  const axisWithoutTitle = omit(axis, ['title']);\n  const outlierLayersMixins = partLayerMixins(markDef, 'outliers', config.boxplot, {\n    transform: [{\n      filter: `(${fieldExpr} < ${lowerWhiskerExpr}) || (${fieldExpr} > ${upperWhiskerExpr})`\n    }],\n    mark: 'point',\n    encoding: {\n      [continuousAxis]: {\n        field: continuousAxisChannelDef.field,\n        type: continuousAxisChannelDef.type,\n        ...(title !== undefined ? {\n          title\n        } : {}),\n        ...(scale !== undefined ? {\n          scale\n        } : {}),\n        // add axis without title since we already added the title above\n        ...(isEmpty(axisWithoutTitle) ? {} : {\n          axis: axisWithoutTitle\n        })\n      },\n      ...encodingWithoutSizeColorContinuousAxisAndTooltip,\n      ...(color ? {\n        color\n      } : {}),\n      ...(customTooltipWithoutAggregatedField ? {\n        tooltip: customTooltipWithoutAggregatedField\n      } : {})\n    }\n  })[0];\n  let filteredLayersMixins;\n  const filteredLayersMixinsTransforms = [...bins, ...timeUnits, joinaggregateTransform];\n  if (outlierLayersMixins) {\n    filteredLayersMixins = {\n      transform: filteredLayersMixinsTransforms,\n      layer: [outlierLayersMixins, filteredWhiskerSpec]\n    };\n  } else {\n    filteredLayersMixins = filteredWhiskerSpec;\n    filteredLayersMixins.transform.unshift(...filteredLayersMixinsTransforms);\n  }\n  return {\n    ...outerSpec,\n    layer: [filteredLayersMixins, {\n      // boxplot\n      transform,\n      layer: boxLayers\n    }]\n  };\n}\nfunction boxParamsQuartiles(continousAxisField) {\n  return [{\n    op: 'q1',\n    field: continousAxisField,\n    as: `lower_box_${continousAxisField}`\n  }, {\n    op: 'q3',\n    field: continousAxisField,\n    as: `upper_box_${continousAxisField}`\n  }];\n}\nfunction boxParams(spec, extent, config) {\n  const orient = compositeMarkOrient(spec, BOXPLOT);\n  const {\n    continuousAxisChannelDef,\n    continuousAxis\n  } = compositeMarkContinuousAxis(spec, orient, BOXPLOT);\n  const continuousFieldName = continuousAxisChannelDef.field;\n  const boxPlotType = getBoxPlotType(extent);\n  const boxplotSpecificAggregate = [...boxParamsQuartiles(continuousFieldName), {\n    op: 'median',\n    field: continuousFieldName,\n    as: `mid_box_${continuousFieldName}`\n  }, {\n    op: 'min',\n    field: continuousFieldName,\n    as: (boxPlotType === 'min-max' ? 'lower_whisker_' : 'min_') + continuousFieldName\n  }, {\n    op: 'max',\n    field: continuousFieldName,\n    as: (boxPlotType === 'min-max' ? 'upper_whisker_' : 'max_') + continuousFieldName\n  }];\n  const postAggregateCalculates = boxPlotType === 'min-max' || boxPlotType === 'tukey' ? [] : [\n  // This is for the  original k-IQR, which we do not expose\n  {\n    calculate: `datum[\"upper_box_${continuousFieldName}\"] - datum[\"lower_box_${continuousFieldName}\"]`,\n    as: `iqr_${continuousFieldName}`\n  }, {\n    calculate: `min(datum[\"upper_box_${continuousFieldName}\"] + datum[\"iqr_${continuousFieldName}\"] * ${extent}, datum[\"max_${continuousFieldName}\"])`,\n    as: `upper_whisker_${continuousFieldName}`\n  }, {\n    calculate: `max(datum[\"lower_box_${continuousFieldName}\"] - datum[\"iqr_${continuousFieldName}\"] * ${extent}, datum[\"min_${continuousFieldName}\"])`,\n    as: `lower_whisker_${continuousFieldName}`\n  }];\n  const {\n    [continuousAxis]: oldContinuousAxisChannelDef,\n    ...oldEncodingWithoutContinuousAxis\n  } = spec.encoding;\n  const {\n    customTooltipWithoutAggregatedField,\n    filteredEncoding\n  } = filterTooltipWithAggregatedField(oldEncodingWithoutContinuousAxis);\n  const {\n    bins,\n    timeUnits,\n    aggregate,\n    groupby,\n    encoding: encodingWithoutContinuousAxis\n  } = extractTransformsFromEncoding(filteredEncoding, config);\n  const ticksOrient = orient === 'vertical' ? 'horizontal' : 'vertical';\n  const boxOrient = orient;\n  const transform = [...bins, ...timeUnits, {\n    aggregate: [...aggregate, ...boxplotSpecificAggregate],\n    groupby\n  }, ...postAggregateCalculates];\n  return {\n    bins,\n    timeUnits,\n    transform,\n    groupby,\n    aggregate,\n    continuousAxisChannelDef,\n    continuousAxis,\n    encodingWithoutContinuousAxis,\n    ticksOrient,\n    boxOrient,\n    customTooltipWithoutAggregatedField\n  };\n}","map":{"version":3,"names":["isNumber","isObject","getMarkPropOrConfig","extractTransformsFromEncoding","normalizeEncoding","log","isMarkDef","isEmpty","omit","CompositeMarkNormalizer","compositeMarkContinuousAxis","compositeMarkOrient","filterTooltipWithAggregatedField","getCompositeMarkTooltip","getTitle","makeCompositeAggregatePartFactory","partLayerMixins","BOXPLOT","BOXPLOT_PARTS","boxPlotNormalizer","normalizeBoxPlot","getBoxPlotType","extent","spec","config","encoding","mark","_encoding","params","projection","_p","outerSpec","markDef","type","warn","message","selectionNotSupported","boxplot","sizeValue","invalid","boxPlotType","bins","timeUnits","transform","continuousAxisChannelDef","continuousAxis","groupby","aggregate","encodingWithoutContinuousAxis","ticksOrient","boxOrient","customTooltipWithoutAggregatedField","boxParams","color","size","encodingWithoutSizeColorAndContinuousAxis","makeBoxPlotPart","sharedEncoding","makeBoxPlotExtent","makeBoxPlotBox","makeBoxPlotMidTick","fiveSummaryTooltipEncoding","fieldPrefix","titlePrefix","endTick","opacity","orient","aria","whiskerTooltipEncoding","whiskerLayers","partName","positionPrefix","endPositionPrefix","extraEncoding","boxLayers","ariaRoleDescription","median","concat","layer","lowerBoxExpr","field","upperBoxExpr","iqrExpr","lowerWhiskerExpr","upperWhiskerExpr","fieldExpr","joinaggregateTransform","joinaggregate","boxParamsQuartiles","filteredWhiskerSpec","filter","op","as","tooltip","encodingWithoutSizeColorContinuousAxisAndTooltip","scale","axis","title","axisWithoutTitle","outlierLayersMixins","undefined","filteredLayersMixins","filteredLayersMixinsTransforms","unshift","continousAxisField","continuousFieldName","boxplotSpecificAggregate","postAggregateCalculates","calculate","oldContinuousAxisChannelDef","oldEncodingWithoutContinuousAxis","filteredEncoding"],"sources":["../../../src/compositemark/boxplot.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}