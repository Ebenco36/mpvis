{"ast":null,"code":"import { isString } from 'vega-util';\nimport { initConfig } from '../config';\nimport * as log from '../log';\nimport { isLayerSpec, isUnitSpec } from '../spec';\nimport { deepEqual } from '../util';\nimport { CoreNormalizer } from './core';\nimport { SelectionCompatibilityNormalizer } from './selectioncompat';\nimport { TopLevelSelectionsNormalizer } from './toplevelselection';\nexport function normalize(spec, config) {\n  if (config === undefined) {\n    config = initConfig(spec.config);\n  }\n  const normalizedSpec = normalizeGenericSpec(spec, config);\n  const {\n    width,\n    height\n  } = spec;\n  const autosize = normalizeAutoSize(normalizedSpec, {\n    width,\n    height,\n    autosize: spec.autosize\n  }, config);\n  return {\n    ...normalizedSpec,\n    ...(autosize ? {\n      autosize\n    } : {})\n  };\n}\nconst coreNormalizer = new CoreNormalizer();\nconst selectionCompatNormalizer = new SelectionCompatibilityNormalizer();\nconst topLevelSelectionNormalizer = new TopLevelSelectionsNormalizer();\n/**\n * Decompose extended unit specs into composition of pure unit specs.\n * And push top-level selection definitions down to unit specs.\n */\nfunction normalizeGenericSpec(spec, config = {}) {\n  const normParams = {\n    config\n  };\n  return topLevelSelectionNormalizer.map(coreNormalizer.map(selectionCompatNormalizer.map(spec, normParams), normParams), normParams);\n}\nfunction _normalizeAutoSize(autosize) {\n  return isString(autosize) ? {\n    type: autosize\n  } : autosize ?? {};\n}\n/**\n * Normalize autosize and deal with width or height == \"container\".\n */\nexport function normalizeAutoSize(spec, sizeInfo, config) {\n  let {\n    width,\n    height\n  } = sizeInfo;\n  const isFitCompatible = isUnitSpec(spec) || isLayerSpec(spec);\n  const autosizeDefault = {};\n  if (!isFitCompatible) {\n    // If spec is not compatible with autosize == \"fit\", discard width/height == container\n    if (width == 'container') {\n      log.warn(log.message.containerSizeNonSingle('width'));\n      width = undefined;\n    }\n    if (height == 'container') {\n      log.warn(log.message.containerSizeNonSingle('height'));\n      height = undefined;\n    }\n  } else {\n    // Default autosize parameters to fit when width/height is \"container\"\n    if (width == 'container' && height == 'container') {\n      autosizeDefault.type = 'fit';\n      autosizeDefault.contains = 'padding';\n    } else if (width == 'container') {\n      autosizeDefault.type = 'fit-x';\n      autosizeDefault.contains = 'padding';\n    } else if (height == 'container') {\n      autosizeDefault.type = 'fit-y';\n      autosizeDefault.contains = 'padding';\n    }\n  }\n  const autosize = {\n    type: 'pad',\n    ...autosizeDefault,\n    ...(config ? _normalizeAutoSize(config.autosize) : {}),\n    ..._normalizeAutoSize(spec.autosize)\n  };\n  if (autosize.type === 'fit' && !isFitCompatible) {\n    log.warn(log.message.FIT_NON_SINGLE);\n    autosize.type = 'pad';\n  }\n  if (width == 'container' && !(autosize.type == 'fit' || autosize.type == 'fit-x')) {\n    log.warn(log.message.containerSizeNotCompatibleWithAutosize('width'));\n  }\n  if (height == 'container' && !(autosize.type == 'fit' || autosize.type == 'fit-y')) {\n    log.warn(log.message.containerSizeNotCompatibleWithAutosize('height'));\n  }\n  // Delete autosize property if it's Vega's default\n  if (deepEqual(autosize, {\n    type: 'pad'\n  })) {\n    return undefined;\n  }\n  return autosize;\n}","map":{"version":3,"names":["isString","initConfig","log","isLayerSpec","isUnitSpec","deepEqual","CoreNormalizer","SelectionCompatibilityNormalizer","TopLevelSelectionsNormalizer","normalize","spec","config","undefined","normalizedSpec","normalizeGenericSpec","width","height","autosize","normalizeAutoSize","coreNormalizer","selectionCompatNormalizer","topLevelSelectionNormalizer","normParams","map","_normalizeAutoSize","type","sizeInfo","isFitCompatible","autosizeDefault","warn","message","containerSizeNonSingle","contains","FIT_NON_SINGLE","containerSizeNotCompatibleWithAutosize"],"sources":["../../../src/normalize/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}