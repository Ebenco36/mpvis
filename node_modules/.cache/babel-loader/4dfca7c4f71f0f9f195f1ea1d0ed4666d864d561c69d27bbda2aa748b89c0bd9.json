{"ast":null,"code":"import { isArray, isObject } from 'vega-util';\nimport { isBinned, isBinning } from '../../bin';\nimport { X } from '../../channel';\nimport { isDiscrete, isFieldDef, toFieldDefBase, valueArray } from '../../channeldef';\nimport { hasDiscreteDomain } from '../../scale';\nimport { durationExpr, normalizeTimeUnit } from '../../timeunit';\nimport { NOMINAL, ORDINAL } from '../../type';\nimport { contains, normalizeAngle } from '../../util';\nimport { isSignalRef } from '../../vega.schema';\nimport { mergeTitle, mergeTitleFieldDefs } from '../common';\nimport { getAxisConfig } from './config';\nexport const axisRules = {\n  scale: ({\n    model,\n    channel\n  }) => model.scaleName(channel),\n  format: ({\n    format\n  }) => format,\n  formatType: ({\n    formatType\n  }) => formatType,\n  grid: ({\n    fieldOrDatumDef,\n    axis,\n    scaleType\n  }) => axis.grid ?? defaultGrid(scaleType, fieldOrDatumDef),\n  gridScale: ({\n    model,\n    channel\n  }) => gridScale(model, channel),\n  labelAlign: ({\n    axis,\n    labelAngle,\n    orient,\n    channel\n  }) => axis.labelAlign || defaultLabelAlign(labelAngle, orient, channel),\n  labelAngle: ({\n    labelAngle\n  }) => labelAngle,\n  labelBaseline: ({\n    axis,\n    labelAngle,\n    orient,\n    channel\n  }) => axis.labelBaseline || defaultLabelBaseline(labelAngle, orient, channel),\n  labelFlush: ({\n    axis,\n    fieldOrDatumDef,\n    channel\n  }) => axis.labelFlush ?? defaultLabelFlush(fieldOrDatumDef.type, channel),\n  labelOverlap: ({\n    axis,\n    fieldOrDatumDef,\n    scaleType\n  }) => axis.labelOverlap ?? defaultLabelOverlap(fieldOrDatumDef.type, scaleType, isFieldDef(fieldOrDatumDef) && !!fieldOrDatumDef.timeUnit, isFieldDef(fieldOrDatumDef) ? fieldOrDatumDef.sort : undefined),\n  // we already calculate orient in parse\n  orient: ({\n    orient\n  }) => orient,\n  tickCount: ({\n    channel,\n    model,\n    axis,\n    fieldOrDatumDef,\n    scaleType\n  }) => {\n    const sizeType = channel === 'x' ? 'width' : channel === 'y' ? 'height' : undefined;\n    const size = sizeType ? model.getSizeSignalRef(sizeType) : undefined;\n    return axis.tickCount ?? defaultTickCount({\n      fieldOrDatumDef,\n      scaleType,\n      size,\n      values: axis.values\n    });\n  },\n  tickMinStep: defaultTickMinStep,\n  title: ({\n    axis,\n    model,\n    channel\n  }) => {\n    if (axis.title !== undefined) {\n      return axis.title;\n    }\n    const fieldDefTitle = getFieldDefTitle(model, channel);\n    if (fieldDefTitle !== undefined) {\n      return fieldDefTitle;\n    }\n    const fieldDef = model.typedFieldDef(channel);\n    const channel2 = channel === 'x' ? 'x2' : 'y2';\n    const fieldDef2 = model.fieldDef(channel2);\n    // If title not specified, store base parts of fieldDef (and fieldDef2 if exists)\n    return mergeTitleFieldDefs(fieldDef ? [toFieldDefBase(fieldDef)] : [], isFieldDef(fieldDef2) ? [toFieldDefBase(fieldDef2)] : []);\n  },\n  values: ({\n    axis,\n    fieldOrDatumDef\n  }) => values(axis, fieldOrDatumDef),\n  zindex: ({\n    axis,\n    fieldOrDatumDef,\n    mark\n  }) => axis.zindex ?? defaultZindex(mark, fieldOrDatumDef)\n};\n// TODO: we need to refactor this method after we take care of config refactoring\n/**\n * Default rules for whether to show a grid should be shown for a channel.\n * If `grid` is unspecified, the default value is `true` for ordinal scales that are not binned\n */\nexport function defaultGrid(scaleType, fieldDef) {\n  return !hasDiscreteDomain(scaleType) && isFieldDef(fieldDef) && !isBinning(fieldDef?.bin) && !isBinned(fieldDef?.bin);\n}\nexport function gridScale(model, channel) {\n  const gridChannel = channel === 'x' ? 'y' : 'x';\n  if (model.getScaleComponent(gridChannel)) {\n    return model.scaleName(gridChannel);\n  }\n  return undefined;\n}\nexport function getLabelAngle(fieldOrDatumDef, axis, channel, styleConfig, axisConfigs) {\n  const labelAngle = axis?.labelAngle;\n  // try axis value\n  if (labelAngle !== undefined) {\n    return isSignalRef(labelAngle) ? labelAngle : normalizeAngle(labelAngle);\n  } else {\n    // try axis config value\n    const {\n      configValue: angle\n    } = getAxisConfig('labelAngle', styleConfig, axis?.style, axisConfigs);\n    if (angle !== undefined) {\n      return normalizeAngle(angle);\n    } else {\n      // get default value\n      if (channel === X && contains([NOMINAL, ORDINAL], fieldOrDatumDef.type) && !(isFieldDef(fieldOrDatumDef) && fieldOrDatumDef.timeUnit)) {\n        return 270;\n      }\n      // no default\n      return undefined;\n    }\n  }\n}\nexport function normalizeAngleExpr(angle) {\n  return `(((${angle.signal} % 360) + 360) % 360)`;\n}\nexport function defaultLabelBaseline(angle, orient, channel, alwaysIncludeMiddle) {\n  if (angle !== undefined) {\n    if (channel === 'x') {\n      if (isSignalRef(angle)) {\n        const a = normalizeAngleExpr(angle);\n        const orientIsTop = isSignalRef(orient) ? `(${orient.signal} === \"top\")` : orient === 'top';\n        return {\n          signal: `(45 < ${a} && ${a} < 135) || (225 < ${a} && ${a} < 315) ? \"middle\" :` + `(${a} <= 45 || 315 <= ${a}) === ${orientIsTop} ? \"bottom\" : \"top\"`\n        };\n      }\n      if (45 < angle && angle < 135 || 225 < angle && angle < 315) {\n        return 'middle';\n      }\n      if (isSignalRef(orient)) {\n        const op = angle <= 45 || 315 <= angle ? '===' : '!==';\n        return {\n          signal: `${orient.signal} ${op} \"top\" ? \"bottom\" : \"top\"`\n        };\n      }\n      return (angle <= 45 || 315 <= angle) === (orient === 'top') ? 'bottom' : 'top';\n    } else {\n      if (isSignalRef(angle)) {\n        const a = normalizeAngleExpr(angle);\n        const orientIsLeft = isSignalRef(orient) ? `(${orient.signal} === \"left\")` : orient === 'left';\n        const middle = alwaysIncludeMiddle ? '\"middle\"' : 'null';\n        return {\n          signal: `${a} <= 45 || 315 <= ${a} || (135 <= ${a} && ${a} <= 225) ? ${middle} : (45 <= ${a} && ${a} <= 135) === ${orientIsLeft} ? \"top\" : \"bottom\"`\n        };\n      }\n      if (angle <= 45 || 315 <= angle || 135 <= angle && angle <= 225) {\n        return alwaysIncludeMiddle ? 'middle' : null;\n      }\n      if (isSignalRef(orient)) {\n        const op = 45 <= angle && angle <= 135 ? '===' : '!==';\n        return {\n          signal: `${orient.signal} ${op} \"left\" ? \"top\" : \"bottom\"`\n        };\n      }\n      return (45 <= angle && angle <= 135) === (orient === 'left') ? 'top' : 'bottom';\n    }\n  }\n  return undefined;\n}\nexport function defaultLabelAlign(angle, orient, channel) {\n  if (angle === undefined) {\n    return undefined;\n  }\n  const isX = channel === 'x';\n  const startAngle = isX ? 0 : 90;\n  const mainOrient = isX ? 'bottom' : 'left';\n  if (isSignalRef(angle)) {\n    const a = normalizeAngleExpr(angle);\n    const orientIsMain = isSignalRef(orient) ? `(${orient.signal} === \"${mainOrient}\")` : orient === mainOrient;\n    return {\n      signal: `(${startAngle ? `(${a} + 90)` : a} % 180 === 0) ? ${isX ? null : '\"center\"'} :` + `(${startAngle} < ${a} && ${a} < ${180 + startAngle}) === ${orientIsMain} ? \"left\" : \"right\"`\n    };\n  }\n  if ((angle + startAngle) % 180 === 0) {\n    // For bottom, use default label align so label flush still works\n    return isX ? null : 'center';\n  }\n  if (isSignalRef(orient)) {\n    const op = startAngle < angle && angle < 180 + startAngle ? '===' : '!==';\n    const orientIsMain = `${orient.signal} ${op} \"${mainOrient}\"`;\n    return {\n      signal: `${orientIsMain} ? \"left\" : \"right\"`\n    };\n  }\n  if ((startAngle < angle && angle < 180 + startAngle) === (orient === mainOrient)) {\n    return 'left';\n  }\n  return 'right';\n}\nexport function defaultLabelFlush(type, channel) {\n  if (channel === 'x' && contains(['quantitative', 'temporal'], type)) {\n    return true;\n  }\n  return undefined;\n}\nexport function defaultLabelOverlap(type, scaleType, hasTimeUnit, sort) {\n  // do not prevent overlap for nominal data because there is no way to infer what the missing labels are\n  if (hasTimeUnit && !isObject(sort) || type !== 'nominal' && type !== 'ordinal') {\n    if (scaleType === 'log' || scaleType === 'symlog') {\n      return 'greedy';\n    }\n    return true;\n  }\n  return undefined;\n}\nexport function defaultOrient(channel) {\n  return channel === 'x' ? 'bottom' : 'left';\n}\nexport function defaultTickCount({\n  fieldOrDatumDef,\n  scaleType,\n  size,\n  values: vals\n}) {\n  if (!vals && !hasDiscreteDomain(scaleType) && scaleType !== 'log') {\n    if (isFieldDef(fieldOrDatumDef)) {\n      if (isBinning(fieldOrDatumDef.bin)) {\n        // for binned data, we don't want more ticks than maxbins\n        return {\n          signal: `ceil(${size.signal}/10)`\n        };\n      }\n      if (fieldOrDatumDef.timeUnit && contains(['month', 'hours', 'day', 'quarter'], normalizeTimeUnit(fieldOrDatumDef.timeUnit)?.unit)) {\n        return undefined;\n      }\n    }\n    return {\n      signal: `ceil(${size.signal}/40)`\n    };\n  }\n  return undefined;\n}\nexport function defaultTickMinStep({\n  format,\n  fieldOrDatumDef\n}) {\n  if (format === 'd') {\n    return 1;\n  }\n  if (isFieldDef(fieldOrDatumDef)) {\n    const {\n      timeUnit\n    } = fieldOrDatumDef;\n    if (timeUnit) {\n      const signal = durationExpr(timeUnit);\n      if (signal) {\n        return {\n          signal\n        };\n      }\n    }\n  }\n  return undefined;\n}\nexport function getFieldDefTitle(model, channel) {\n  const channel2 = channel === 'x' ? 'x2' : 'y2';\n  const fieldDef = model.fieldDef(channel);\n  const fieldDef2 = model.fieldDef(channel2);\n  const title1 = fieldDef ? fieldDef.title : undefined;\n  const title2 = fieldDef2 ? fieldDef2.title : undefined;\n  if (title1 && title2) {\n    return mergeTitle(title1, title2);\n  } else if (title1) {\n    return title1;\n  } else if (title2) {\n    return title2;\n  } else if (title1 !== undefined) {\n    // falsy value to disable config\n    return title1;\n  } else if (title2 !== undefined) {\n    // falsy value to disable config\n    return title2;\n  }\n  return undefined;\n}\nexport function values(axis, fieldOrDatumDef) {\n  const vals = axis.values;\n  if (isArray(vals)) {\n    return valueArray(fieldOrDatumDef, vals);\n  } else if (isSignalRef(vals)) {\n    return vals;\n  }\n  return undefined;\n}\nexport function defaultZindex(mark, fieldDef) {\n  if (mark === 'rect' && isDiscrete(fieldDef)) {\n    return 1;\n  }\n  return 0;\n}","map":{"version":3,"names":["isArray","isObject","isBinned","isBinning","X","isDiscrete","isFieldDef","toFieldDefBase","valueArray","hasDiscreteDomain","durationExpr","normalizeTimeUnit","NOMINAL","ORDINAL","contains","normalizeAngle","isSignalRef","mergeTitle","mergeTitleFieldDefs","getAxisConfig","axisRules","scale","model","channel","scaleName","format","formatType","grid","fieldOrDatumDef","axis","scaleType","defaultGrid","gridScale","labelAlign","labelAngle","orient","defaultLabelAlign","labelBaseline","defaultLabelBaseline","labelFlush","defaultLabelFlush","type","labelOverlap","defaultLabelOverlap","timeUnit","sort","undefined","tickCount","sizeType","size","getSizeSignalRef","defaultTickCount","values","tickMinStep","defaultTickMinStep","title","fieldDefTitle","getFieldDefTitle","fieldDef","typedFieldDef","channel2","fieldDef2","zindex","mark","defaultZindex","bin","gridChannel","getScaleComponent","getLabelAngle","styleConfig","axisConfigs","configValue","angle","style","normalizeAngleExpr","signal","alwaysIncludeMiddle","a","orientIsTop","op","orientIsLeft","middle","isX","startAngle","mainOrient","orientIsMain","hasTimeUnit","defaultOrient","vals","unit","title1","title2"],"sources":["../../../../src/compile/axis/properties.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}