{"ast":null,"code":"import { duplicate, hash, unique } from '../../util';\nimport { DataFlowNode } from './dataflow';\n/**\n * A class for pivot transform nodes.\n */\nexport class PivotTransformNode extends DataFlowNode {\n  clone() {\n    return new PivotTransformNode(null, duplicate(this.transform));\n  }\n  constructor(parent, transform) {\n    super(parent);\n    this.transform = transform;\n  }\n  addDimensions(fields) {\n    this.transform.groupby = unique((this.transform.groupby ?? []).concat(fields), d => d);\n  }\n  producedFields() {\n    return undefined; // return undefined so that potentially everything can depend on the pivot\n  }\n\n  dependentFields() {\n    return new Set([this.transform.pivot, this.transform.value, ...(this.transform.groupby ?? [])]);\n  }\n  hash() {\n    return `PivotTransform ${hash(this.transform)}`;\n  }\n  assemble() {\n    const {\n      pivot,\n      value,\n      groupby,\n      limit,\n      op\n    } = this.transform;\n    return {\n      type: 'pivot',\n      field: pivot,\n      value,\n      ...(limit !== undefined ? {\n        limit\n      } : {}),\n      ...(op !== undefined ? {\n        op\n      } : {}),\n      ...(groupby !== undefined ? {\n        groupby\n      } : {})\n    };\n  }\n}","map":{"version":3,"names":["duplicate","hash","unique","DataFlowNode","PivotTransformNode","clone","transform","constructor","parent","addDimensions","fields","groupby","concat","d","producedFields","undefined","dependentFields","Set","pivot","value","assemble","limit","op","type","field"],"sources":["../../../../src/compile/data/pivot.ts"],"sourcesContent":[null],"mappings":"AACA,SAAQA,SAAS,EAAEC,IAAI,EAAEC,MAAM,QAAO,YAAY;AAElD,SAAQC,YAAY,QAAO,YAAY;AAEvC;;;AAGA,OAAM,MAAOC,kBAAmB,SAAQD,YAAY;EAC3CE,KAAKA,CAAA;IACV,OAAO,IAAID,kBAAkB,CAAC,IAAI,EAAEJ,SAAS,CAAC,IAAI,CAACM,SAAS,CAAC,CAAC;EAChE;EAEAC,YAAYC,MAAoB,EAAUF,SAAyB;IACjE,KAAK,CAACE,MAAM,CAAC;IAD2B,KAAAF,SAAS,GAATA,SAAS;EAEnD;EAEOG,aAAaA,CAACC,MAAyB;IAC5C,IAAI,CAACJ,SAAS,CAACK,OAAO,GAAGT,MAAM,CAAC,CAAC,IAAI,CAACI,SAAS,CAACK,OAAO,IAAI,EAAE,EAAEC,MAAM,CAACF,MAAM,CAAC,EAAEG,CAAC,IAAIA,CAAC,CAAC;EACxF;EAEOC,cAAcA,CAAA;IACnB,OAAOC,SAAS,CAAC,CAAC;EACpB;;EAEOC,eAAeA,CAAA;IACpB,OAAO,IAAIC,GAAG,CAAC,CAAC,IAAI,CAACX,SAAS,CAACY,KAAK,EAAE,IAAI,CAACZ,SAAS,CAACa,KAAK,EAAE,IAAI,IAAI,CAACb,SAAS,CAACK,OAAO,IAAI,EAAE,CAAC,CAAC,CAAC;EACjG;EAEOV,IAAIA,CAAA;IACT,OAAO,kBAAkBA,IAAI,CAAC,IAAI,CAACK,SAAS,CAAC,EAAE;EACjD;EAEOc,QAAQA,CAAA;IACb,MAAM;MAACF,KAAK;MAAEC,KAAK;MAAER,OAAO;MAAEU,KAAK;MAAEC;IAAE,CAAC,GAAG,IAAI,CAAChB,SAAS;IACzD,OAAO;MACLiB,IAAI,EAAE,OAAO;MACbC,KAAK,EAAEN,KAAK;MACZC,KAAK;MACL,IAAIE,KAAK,KAAKN,SAAS,GAAG;QAACM;MAAK,CAAC,GAAG,EAAE,CAAC;MACvC,IAAIC,EAAE,KAAKP,SAAS,GAAG;QAACO;MAAE,CAAC,GAAG,EAAE,CAAC;MACjC,IAAIX,OAAO,KAAKI,SAAS,GAAG;QAACJ;MAAO,CAAC,GAAG,EAAE;KAC3C;EACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}