{"ast":null,"code":"import { duplicate, hash } from '../../util';\nimport { DataFlowNode } from './dataflow';\n/**\n * A class for density transform nodes\n */\nexport class DensityTransformNode extends DataFlowNode {\n  clone() {\n    return new DensityTransformNode(null, duplicate(this.transform));\n  }\n  constructor(parent, transform) {\n    super(parent);\n    this.transform = transform;\n    this.transform = duplicate(transform); // duplicate to prevent side effects\n    const specifiedAs = this.transform.as ?? [undefined, undefined];\n    this.transform.as = [specifiedAs[0] ?? 'value', specifiedAs[1] ?? 'density'];\n    // set steps when we are grouping so that we get consitent sampling points for imputing and grouping\n    if (transform.groupby && transform.minsteps == null && transform.maxsteps == null && transform.steps == null) {\n      this.transform.steps = 200;\n    }\n  }\n  dependentFields() {\n    return new Set([this.transform.density, ...(this.transform.groupby ?? [])]);\n  }\n  producedFields() {\n    return new Set(this.transform.as);\n  }\n  hash() {\n    return `DensityTransform ${hash(this.transform)}`;\n  }\n  assemble() {\n    const {\n      density,\n      ...rest\n    } = this.transform;\n    const result = {\n      type: 'kde',\n      field: density,\n      ...rest\n    };\n    return result;\n  }\n}","map":{"version":3,"names":["duplicate","hash","DataFlowNode","DensityTransformNode","clone","transform","constructor","parent","specifiedAs","as","undefined","groupby","minsteps","maxsteps","steps","dependentFields","Set","density","producedFields","assemble","rest","result","type","field"],"sources":["../../../../src/compile/data/density.ts"],"sourcesContent":[null],"mappings":"AAEA,SAAQA,SAAS,EAAEC,IAAI,QAAO,YAAY;AAC1C,SAAQC,YAAY,QAAO,YAAY;AAEvC;;;AAGA,OAAM,MAAOC,oBAAqB,SAAQD,YAAY;EAC7CE,KAAKA,CAAA;IACV,OAAO,IAAID,oBAAoB,CAAC,IAAI,EAAEH,SAAS,CAAC,IAAI,CAACK,SAAS,CAAC,CAAC;EAClE;EAEAC,YAAYC,MAAoB,EAAUF,SAA2B;IACnE,KAAK,CAACE,MAAM,CAAC;IAD2B,KAAAF,SAAS,GAATA,SAAS;IAEjD,IAAI,CAACA,SAAS,GAAGL,SAAS,CAACK,SAAS,CAAC,CAAC,CAAC;IACvC,MAAMG,WAAW,GAAG,IAAI,CAACH,SAAS,CAACI,EAAE,IAAI,CAACC,SAAS,EAAEA,SAAS,CAAC;IAC/D,IAAI,CAACL,SAAS,CAACI,EAAE,GAAG,CAACD,WAAW,CAAC,CAAC,CAAC,IAAI,OAAO,EAAEA,WAAW,CAAC,CAAC,CAAC,IAAI,SAAS,CAAC;IAE5E;IACA,IAAIH,SAAS,CAACM,OAAO,IAAIN,SAAS,CAACO,QAAQ,IAAI,IAAI,IAAIP,SAAS,CAACQ,QAAQ,IAAI,IAAI,IAAIR,SAAS,CAACS,KAAK,IAAI,IAAI,EAAE;MAC5G,IAAI,CAACT,SAAS,CAACS,KAAK,GAAG,GAAG;;EAE9B;EAEOC,eAAeA,CAAA;IACpB,OAAO,IAAIC,GAAG,CAAC,CAAC,IAAI,CAACX,SAAS,CAACY,OAAO,EAAE,IAAI,IAAI,CAACZ,SAAS,CAACM,OAAO,IAAI,EAAE,CAAC,CAAC,CAAC;EAC7E;EAEOO,cAAcA,CAAA;IACnB,OAAO,IAAIF,GAAG,CAAC,IAAI,CAACX,SAAS,CAACI,EAAE,CAAC;EACnC;EAEOR,IAAIA,CAAA;IACT,OAAO,oBAAoBA,IAAI,CAAC,IAAI,CAACI,SAAS,CAAC,EAAE;EACnD;EAEOc,QAAQA,CAAA;IACb,MAAM;MAACF,OAAO;MAAE,GAAGG;IAAI,CAAC,GAAG,IAAI,CAACf,SAAS;IACzC,MAAMgB,MAAM,GAAmB;MAC7BC,IAAI,EAAE,KAAK;MACXC,KAAK,EAAEN,OAAO;MACd,GAAGG;KACJ;IACD,OAAOC,MAAM;EACf"},"metadata":{},"sourceType":"module","externalDependencies":[]}