{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { parseSelector } from 'vega-event-selector';\nimport { stringValue } from 'vega-util';\nimport { X, Y } from '../../channel';\nimport { BRUSH as INTERVAL_BRUSH } from './interval';\nimport { default as scalesCompiler, domain } from './scales';\nconst ANCHOR = '_zoom_anchor';\nconst DELTA = '_zoom_delta';\nconst zoom = {\n  defined: selCmpt => {\n    return selCmpt.type === 'interval' && selCmpt.zoom;\n  },\n  signals: (model, selCmpt, signals) => {\n    const name = selCmpt.name;\n    const boundScales = scalesCompiler.defined(selCmpt);\n    const delta = name + DELTA;\n    const {\n      x,\n      y\n    } = selCmpt.project.hasChannel;\n    const sx = stringValue(model.scaleName(X));\n    const sy = stringValue(model.scaleName(Y));\n    let events = parseSelector(selCmpt.zoom, 'scope');\n    if (!boundScales) {\n      events = events.map(e => (e.markname = name + INTERVAL_BRUSH, e));\n    }\n    signals.push({\n      name: name + ANCHOR,\n      on: [{\n        events,\n        update: !boundScales ? `{x: x(unit), y: y(unit)}` : '{' + [sx ? `x: invert(${sx}, x(unit))` : '', sy ? `y: invert(${sy}, y(unit))` : ''].filter(expr => expr).join(', ') + '}'\n      }]\n    }, {\n      name: delta,\n      on: [{\n        events,\n        force: true,\n        update: 'pow(1.001, event.deltaY * pow(16, event.deltaMode))'\n      }]\n    });\n    if (x !== undefined) {\n      onDelta(model, selCmpt, x, 'width', signals);\n    }\n    if (y !== undefined) {\n      onDelta(model, selCmpt, y, 'height', signals);\n    }\n    return signals;\n  }\n};\nexport default zoom;\nfunction onDelta(model, selCmpt, proj, size, signals) {\n  const name = selCmpt.name;\n  const channel = proj.channel;\n  const boundScales = scalesCompiler.defined(selCmpt);\n  const signal = signals.filter(s => s.name === proj.signals[boundScales ? 'data' : 'visual'])[0];\n  const sizeSg = model.getSizeSignalRef(size).signal;\n  const scaleCmpt = model.getScaleComponent(channel);\n  const scaleType = scaleCmpt && scaleCmpt.get('type');\n  const base = boundScales ? domain(model, channel) : signal.name;\n  const delta = name + DELTA;\n  const anchor = `${name}${ANCHOR}.${channel}`;\n  const zoomFn = !boundScales || !scaleCmpt ? 'zoomLinear' : scaleType === 'log' ? 'zoomLog' : scaleType === 'symlog' ? 'zoomSymlog' : scaleType === 'pow' ? 'zoomPow' : 'zoomLinear';\n  const arg = !boundScales ? '' : scaleType === 'pow' ? `, ${scaleCmpt.get('exponent') ?? 1}` : scaleType === 'symlog' ? `, ${scaleCmpt.get('constant') ?? 1}` : '';\n  const update = `${zoomFn}(${base}, ${anchor}, ${delta}${arg})`;\n  signal.on.push({\n    events: {\n      signal: delta\n    },\n    update: boundScales ? update : `clampRange(${update}, 0, ${sizeSg})`\n  });\n}","map":{"version":3,"names":["parseSelector","stringValue","X","Y","BRUSH","INTERVAL_BRUSH","default","scalesCompiler","domain","ANCHOR","DELTA","zoom","defined","selCmpt","type","signals","model","name","boundScales","delta","x","y","project","hasChannel","sx","scaleName","sy","events","map","e","markname","push","on","update","filter","expr","join","force","undefined","onDelta","proj","size","channel","signal","s","sizeSg","getSizeSignalRef","scaleCmpt","getScaleComponent","scaleType","get","base","anchor","zoomFn","arg"],"sources":["../../../../src/compile/selection/zoom.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}