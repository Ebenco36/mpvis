{"ast":null,"code":"import { vgField } from '../../channeldef';\nimport { DEFAULT_SORT_OP, isSortField } from '../../sort';\nimport { facetSortFieldName } from '../facet';\nimport { JoinAggregateTransformNode } from './joinaggregate';\nexport function makeJoinAggregateFromFacet(parent, facet) {\n  const {\n    row,\n    column\n  } = facet;\n  if (row && column) {\n    let newParent = null;\n    // only need to make one for crossed facet\n    for (const fieldDef of [row, column]) {\n      if (isSortField(fieldDef.sort)) {\n        const {\n          field,\n          op = DEFAULT_SORT_OP\n        } = fieldDef.sort;\n        parent = newParent = new JoinAggregateTransformNode(parent, {\n          joinaggregate: [{\n            op,\n            field,\n            as: facetSortFieldName(fieldDef, fieldDef.sort, {\n              forAs: true\n            })\n          }],\n          groupby: [vgField(fieldDef)]\n        });\n      }\n    }\n    return newParent;\n  }\n  return null;\n}","map":{"version":3,"names":["vgField","DEFAULT_SORT_OP","isSortField","facetSortFieldName","JoinAggregateTransformNode","makeJoinAggregateFromFacet","parent","facet","row","column","newParent","fieldDef","sort","field","op","joinaggregate","as","forAs","groupby"],"sources":["../../../../src/compile/data/joinaggregatefacet.ts"],"sourcesContent":[null],"mappings":"AAAA,SAAQA,OAAO,QAAO,kBAAkB;AACxC,SAAQC,eAAe,EAAEC,WAAW,QAAO,YAAY;AAEvD,SAAQC,kBAAkB,QAAO,UAAU;AAE3C,SAAQC,0BAA0B,QAAO,iBAAiB;AAE1D,OAAM,SAAUC,0BAA0BA,CACxCC,MAAoB,EACpBC,KAA2B;EAE3B,MAAM;IAACC,GAAG;IAAEC;EAAM,CAAC,GAAGF,KAAK;EAC3B,IAAIC,GAAG,IAAIC,MAAM,EAAE;IACjB,IAAIC,SAAS,GAAG,IAAI;IACpB;IACA,KAAK,MAAMC,QAAQ,IAAI,CAACH,GAAG,EAAEC,MAAM,CAAC,EAAE;MACpC,IAAIP,WAAW,CAACS,QAAQ,CAACC,IAAI,CAAC,EAAE;QAC9B,MAAM;UAACC,KAAK;UAAEC,EAAE,GAAGb;QAAe,CAAC,GAAGU,QAAQ,CAACC,IAAI;QACnDN,MAAM,GAAGI,SAAS,GAAG,IAAIN,0BAA0B,CAACE,MAAM,EAAE;UAC1DS,aAAa,EAAE,CACb;YACED,EAAE;YACFD,KAAK;YACLG,EAAE,EAAEb,kBAAkB,CAACQ,QAAQ,EAAEA,QAAQ,CAACC,IAAI,EAAE;cAACK,KAAK,EAAE;YAAI,CAAC;WAC9D,CACF;UACDC,OAAO,EAAE,CAAClB,OAAO,CAACW,QAAQ,CAAC;SAC5B,CAAC;;;IAGN,OAAOD,SAAS;;EAElB,OAAO,IAAI;AACb"},"metadata":{},"sourceType":"module","externalDependencies":[]}