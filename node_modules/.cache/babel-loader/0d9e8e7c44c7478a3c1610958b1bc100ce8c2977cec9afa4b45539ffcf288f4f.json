{"ast":null,"code":"import { isString } from 'vega';\nimport { stringValue } from 'vega-util';\nimport { FACET_CHANNELS } from '../../channel';\nimport { vals } from '../../util';\nimport { isFacetModel } from '../model';\nimport interval from './interval';\nimport point from './point';\nimport clear from './clear';\nimport inputs from './inputs';\nimport nearest from './nearest';\nimport project from './project';\nimport scales from './scales';\nimport legends from './legends';\nimport toggle from './toggle';\nimport translate from './translate';\nimport zoom from './zoom';\nexport const STORE = '_store';\nexport const TUPLE = '_tuple';\nexport const MODIFY = '_modify';\nexport const SELECTION_DOMAIN = '_selection_domain_';\nexport const VL_SELECTION_RESOLVE = 'vlSelectionResolve';\n// Order matters for parsing and assembly.\nexport const selectionCompilers = [point, interval, project, toggle,\n// Bindings may disable direct manipulation.\ninputs, scales, legends, clear, translate, zoom, nearest];\nfunction getFacetModel(model) {\n  let parent = model.parent;\n  while (parent) {\n    if (isFacetModel(parent)) break;\n    parent = parent.parent;\n  }\n  return parent;\n}\nexport function unitName(model, {\n  escape\n} = {\n  escape: true\n}) {\n  let name = escape ? stringValue(model.name) : model.name;\n  const facetModel = getFacetModel(model);\n  if (facetModel) {\n    const {\n      facet\n    } = facetModel;\n    for (const channel of FACET_CHANNELS) {\n      if (facet[channel]) {\n        name += ` + '__facet_${channel}_' + (facet[${stringValue(facetModel.vgField(channel))}])`;\n      }\n    }\n  }\n  return name;\n}\nexport function requiresSelectionId(model) {\n  return vals(model.component.selection ?? {}).reduce((identifier, selCmpt) => {\n    return identifier || selCmpt.project.hasSelectionId;\n  }, false);\n}\n// Binding a point selection to query widgets or legends disables default direct manipulation interaction.\n// A user can choose to re-enable it by explicitly specifying triggering input events.\nexport function disableDirectManipulation(selCmpt, selDef) {\n  if (isString(selDef.select) || !selDef.select.on) delete selCmpt.events;\n  if (isString(selDef.select) || !selDef.select.clear) delete selCmpt.clear;\n  if (isString(selDef.select) || !selDef.select.toggle) delete selCmpt.toggle;\n}","map":{"version":3,"names":["isString","stringValue","FACET_CHANNELS","vals","isFacetModel","interval","point","clear","inputs","nearest","project","scales","legends","toggle","translate","zoom","STORE","TUPLE","MODIFY","SELECTION_DOMAIN","VL_SELECTION_RESOLVE","selectionCompilers","getFacetModel","model","parent","unitName","escape","name","facetModel","facet","channel","vgField","requiresSelectionId","component","selection","reduce","identifier","selCmpt","hasSelectionId","disableDirectManipulation","selDef","select","on","events"],"sources":["../../../../src/compile/selection/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}