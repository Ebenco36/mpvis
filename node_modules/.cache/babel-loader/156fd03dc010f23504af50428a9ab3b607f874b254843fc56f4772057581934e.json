{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// DateTime definition object\nimport { isNumber, isObject } from 'vega-util';\nimport * as log from './log';\nimport { TIMEUNIT_PARTS } from './timeunit';\nimport { duplicate, isNumeric, keys } from './util';\nexport function isDateTime(o) {\n  if (o && isObject(o)) {\n    for (const part of TIMEUNIT_PARTS) {\n      if (part in o) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\nexport const MONTHS = ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'];\nexport const SHORT_MONTHS = MONTHS.map(m => m.substr(0, 3));\nexport const DAYS = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];\nexport const SHORT_DAYS = DAYS.map(d => d.substr(0, 3));\nfunction normalizeQuarter(q) {\n  if (isNumeric(q)) {\n    q = +q;\n  }\n  if (isNumber(q)) {\n    if (q > 4) {\n      log.warn(log.message.invalidTimeUnit('quarter', q));\n    }\n    // We accept 1-based quarter, so need to readjust to 0-based quarter\n    return q - 1;\n  } else {\n    // Invalid quarter\n    throw new Error(log.message.invalidTimeUnit('quarter', q));\n  }\n}\nfunction normalizeMonth(m) {\n  if (isNumeric(m)) {\n    m = +m;\n  }\n  if (isNumber(m)) {\n    // We accept 1-based month, so need to readjust to 0-based month\n    return m - 1;\n  } else {\n    const lowerM = m.toLowerCase();\n    const monthIndex = MONTHS.indexOf(lowerM);\n    if (monthIndex !== -1) {\n      return monthIndex; // 0 for january, ...\n    }\n\n    const shortM = lowerM.substr(0, 3);\n    const shortMonthIndex = SHORT_MONTHS.indexOf(shortM);\n    if (shortMonthIndex !== -1) {\n      return shortMonthIndex;\n    }\n    // Invalid month\n    throw new Error(log.message.invalidTimeUnit('month', m));\n  }\n}\nfunction normalizeDay(d) {\n  if (isNumeric(d)) {\n    d = +d;\n  }\n  if (isNumber(d)) {\n    // mod so that this can be both 0-based where 0 = sunday\n    // and 1-based where 7=sunday\n    return d % 7;\n  } else {\n    const lowerD = d.toLowerCase();\n    const dayIndex = DAYS.indexOf(lowerD);\n    if (dayIndex !== -1) {\n      return dayIndex; // 0 for january, ...\n    }\n\n    const shortD = lowerD.substr(0, 3);\n    const shortDayIndex = SHORT_DAYS.indexOf(shortD);\n    if (shortDayIndex !== -1) {\n      return shortDayIndex;\n    }\n    // Invalid day\n    throw new Error(log.message.invalidTimeUnit('day', d));\n  }\n}\n/**\n * @param d the date.\n * @param normalize whether to normalize quarter, month, day. This should probably be true if d is a DateTime.\n * @returns array of date time parts [year, month, day, hours, minutes, seconds, milliseconds]\n */\nfunction dateTimeParts(d, normalize) {\n  const parts = [];\n  if (normalize && d.day !== undefined) {\n    if (keys(d).length > 1) {\n      log.warn(log.message.droppedDay(d));\n      d = duplicate(d);\n      delete d.day;\n    }\n  }\n  if (d.year !== undefined) {\n    parts.push(d.year);\n  } else {\n    // Just like Vega's timeunit transform, set default year to 2012, so domain conversion will be compatible with Vega\n    // Note: 2012 is a leap year (and so the date February 29 is respected) that begins on a Sunday (and so days of the week will order properly at the beginning of the year).\n    parts.push(2012);\n  }\n  if (d.month !== undefined) {\n    const month = normalize ? normalizeMonth(d.month) : d.month;\n    parts.push(month);\n  } else if (d.quarter !== undefined) {\n    const quarter = normalize ? normalizeQuarter(d.quarter) : d.quarter;\n    parts.push(isNumber(quarter) ? quarter * 3 : `${quarter}*3`);\n  } else {\n    parts.push(0); // months start at zero in JS\n  }\n\n  if (d.date !== undefined) {\n    parts.push(d.date);\n  } else if (d.day !== undefined) {\n    // HACK: Day only works as a standalone unit\n    // This is only correct because we always set year to 2006 for day\n    const day = normalize ? normalizeDay(d.day) : d.day;\n    parts.push(isNumber(day) ? day + 1 : `${day}+1`);\n  } else {\n    parts.push(1); // Date starts at 1 in JS\n  }\n  // Note: can't use TimeUnit enum here as importing it will create\n  // circular dependency problem!\n  for (const timeUnit of ['hours', 'minutes', 'seconds', 'milliseconds']) {\n    const unit = d[timeUnit];\n    parts.push(typeof unit === 'undefined' ? 0 : unit);\n  }\n  return parts;\n}\n/**\n * Return Vega expression for a date time.\n *\n * @param d the date time.\n * @returns the Vega expression.\n */\nexport function dateTimeToExpr(d) {\n  const parts = dateTimeParts(d, true);\n  const string = parts.join(', ');\n  if (d.utc) {\n    return `utc(${string})`;\n  } else {\n    return `datetime(${string})`;\n  }\n}\n/**\n * Return Vega expression for a date time expression.\n *\n * @param d the internal date time object with expression.\n * @returns the Vega expression.\n */\nexport function dateTimeExprToExpr(d) {\n  const parts = dateTimeParts(d, false);\n  const string = parts.join(', ');\n  if (d.utc) {\n    return `utc(${string})`;\n  } else {\n    return `datetime(${string})`;\n  }\n}\n/**\n * @param d the date time.\n * @returns the timestamp.\n */\nexport function dateTimeToTimestamp(d) {\n  const parts = dateTimeParts(d, true);\n  if (d.utc) {\n    return +new Date(Date.UTC(...parts));\n  } else {\n    return +new Date(...parts);\n  }\n}","map":{"version":3,"names":["isNumber","isObject","log","TIMEUNIT_PARTS","duplicate","isNumeric","keys","isDateTime","o","part","MONTHS","SHORT_MONTHS","map","m","substr","DAYS","SHORT_DAYS","d","normalizeQuarter","q","warn","message","invalidTimeUnit","Error","normalizeMonth","lowerM","toLowerCase","monthIndex","indexOf","shortM","shortMonthIndex","normalizeDay","lowerD","dayIndex","shortD","shortDayIndex","dateTimeParts","normalize","parts","day","undefined","length","droppedDay","year","push","month","quarter","date","timeUnit","unit","dateTimeToExpr","string","join","utc","dateTimeExprToExpr","dateTimeToTimestamp","Date","UTC"],"sources":["../../src/datetime.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}